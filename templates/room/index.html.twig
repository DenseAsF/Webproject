{% extends 'adminbase.html.twig' %}

{% block title %}Room Index{% endblock %}

{% block body %}
<div class="max-w-6xl mx-auto mt-10 p-6 bg-white shadow-md rounded-lg">
    <div class="flex justify-between items-center mb-6 helvetica-condensed">
        <h1 class="text-2xl font-bold">Rooms</h1>
        <a href="{{ path('room_new') }}" class="helvetica-condensed bg-[rgb(29,53,153)] text-white px-4 py-2 rounded-md hover:bg-[rgb(242,182,34)] transition">
            Create New Room
        </a>
    </div>

    <div class="mb-6 p-4 bg-gray-50 rounded-lg helvetica-condensed">
        <form method="get" action="{{ path('room_index') }}" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            
            <!-- Search Field -->
            <div>
                <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search Room Number</label>
                <input type="text" 
                       id="search" 
                       name="search" 
                       value="{{ app.request.query.get('search') }}" 
                       placeholder="Enter room number..."
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>

            <!-- Availability Filter -->
            <div>
                <label for="availability" class="block text-sm font-medium text-gray-700 mb-1">Availability</label>
                <select id="availability" 
                        name="availability" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <option value="">All Rooms</option>
                    <option value="available" {{ app.request.query.get('availability') == 'available' ? 'selected' : '' }}>Available</option>
                    <option value="unavailable" {{ app.request.query.get('availability') == 'unavailable' ? 'selected' : '' }}>Unavailable</option>
                </select>
            </div>

            <!-- Room Type Filter -->
            <div>
                <label for="roomType" class="block text-sm font-medium text-gray-700 mb-1">Room Type</label>
                <select id="roomType" 
                        name="roomType" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <option value="">All Types</option>
                    {% for roomType in roomTypes %}
                        <option value="{{ roomType.id }}" {{ app.request.query.get('roomType') == roomType.id ? 'selected' : '' }}>
                            {{ roomType.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Buttons -->
            <div class="flex items-end space-x-2">
                <button type="submit" 
                        class="w-full bg-[rgb(29,53,153)] text-white px-4 py-2 rounded-md hover:bg-[rgb(242,182,34)] transition">
                    Apply Filters
                </button>
                <a href="{{ path('room_index') }}" 
                   class="w-full bg-gray-500 text-white rounded-md px-4 py-2 hover:bg-gray-600 transition text-center">
                    Clear
                </a>
            </div>
        </form>

        <!-- Active Filters Display -->
        {% if app.request.query.get('availability') or app.request.query.get('roomType') or app.request.query.get('search') %}
        <div class="mt-4 flex flex-wrap gap-2">
            <span class="text-sm text-gray-600">Active filters:</span>
            
            {% if app.request.query.get('search') %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    Search: "{{ app.request.query.get('search') }}"
                    <a href="{{ path('room_index', app.request.query.all|merge({'search': null})) }}" 
                       class="ml-1 text-green-600 hover:text-green-800">×</a>
                </span>
            {% endif %}
            
            {% if app.request.query.get('availability') %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {{ app.request.query.get('availability') == 'available' ? 'Available' : 'Unavailable' }}
                    <a href="{{ path('room_index', app.request.query.all|merge({'availability': null})) }}" 
                       class="ml-1 text-blue-600 hover:text-blue-800">×</a>
                </span>
            {% endif %}
            
            {% if app.request.query.get('roomType') %}
                {% set selectedRoomType = roomTypes|filter(rt => rt.id == app.request.query.get('roomType'))|first %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    Type: {{ selectedRoomType.name }}
                    <a href="{{ path('room_index', app.request.query.all|merge({'roomType': null})) }}" 
                       class="ml-1 text-purple-600 hover:text-purple-800">×</a>
                </span>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <div class="mb-4 helvetica-condensed">
        <p class="text-sm text-gray-600">
            Showing {{ rooms|length }} room(s)
            {% if app.request.query.get('availability') or app.request.query.get('roomType') or app.request.query.get('search') %}
                (filtered)
            {% endif %}
        </p>
    </div>

    <!-- Rest of your table remains the same -->
    <div class="helvetica-condensed overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Room Number</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Room Type</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
            {% for room in rooms %}
                <tr class="helvetica-condensed hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">{{ room.id }}</td>
                    <td class="px-6 py-4 whitespace-nowrap font-medium">{{ room.roomNumber }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ room.roomType.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">₱{{ room.price|number_format(2) }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center rounded-full font-medium 
                            {% if room.status.name == 'Available' %} text-green-800
                            {% elseif room.status.name == 'Unavailable' or room.status.name == 'Checked In' %} text-red-600
                            {% else %}bg-blue-100 text-blue-800{% endif %}">
                            {{ room.status.name }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap space-x-4 flex items-center">
                        <a href="{{ path('room_show', {'id': room.id}) }}" class="text-blue-600 hover:text-blue-900 hover:underline">Show</a>
                        <a href="{{ path('room_edit', {'id': room.id}) }}" class="text-green-600 hover:text-green-900 hover:underline">Edit</a>
                        {{ include('room/_delete_form.html.twig') }}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" class="helvetica-condensed px-6 py-4 text-center text-red-600">
                        {% if app.request.query.get('availability') or app.request.query.get('roomType') or app.request.query.get('search') %}
                            No rooms found matching your filters.
                        {% else %}
                            No rooms found. <a href="{{ path('room_new') }}" class="text-blue-600 hover:underline">Create the first one</a>.
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}